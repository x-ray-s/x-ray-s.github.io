(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{472:function(e,t,r){"use strict";r.r(t);var a=r(23),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"page-title"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#page-title"}},[e._v("#")]),e._v(" "+e._s(e.$page.title))]),e._v(" "),r("h2",{attrs:{id:"发现问题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发现问题"}},[e._v("#")]),e._v(" 发现问题")]),e._v(" "),r("p",[e._v("在使用 Ligthhouse 检查网站优化时，发现 Diagnostics(诊断) 类目下有个 "),r("strong",[e._v("Serve static assets with an efficient cache policy")]),e._v(" （静态服务资源使用有效的缓存策略），并且提示 "),r("strong",[e._v("A long cache lifetime can speed up repeat visits to your page. "),r("a",{attrs:{href:"https://developers.google.com/web/tools/lighthouse/audits/cache-policy?utm_medium=devtools&utm_source=lighthouse",target:"_blank",rel:"noopener noreferrer"}},[e._v("Learn more"),r("OutboundLink")],1)]),e._v("。但问题是在 Network 中已经显示资源 "),r("strong",[e._v("from disk cache")]),e._v("，这究竟是为什么呢。")]),e._v(" "),r("p",[e._v("当前场景下关于缓存的设置：")]),e._v(" "),r("ul",[r("li",[e._v("ETag ✅")]),e._v(" "),r("li",[e._v("Last-Modified ✅")]),e._v(" "),r("li",[e._v("Cache-Control ❎")])]),e._v(" "),r("p",[e._v("现在问题就变成了:")]),e._v(" "),r("ul",[r("li",[e._v("为什么没有设置 "),r("code",[e._v("cache-control")]),e._v(" 非强制验证缓存，仍然返回 200 from disk cache ?")]),e._v(" "),r("li",[e._v("浏览器在处理没有 "),r("code",[e._v("cache-control")]),e._v(" 的请求时，使用什么缓存策略 ?")])]),e._v(" "),r("p",[e._v("经过搜索得知")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://tools.ietf.org/html/rfc7234#section-3",target:"_blank",rel:"noopener noreferrer"}},[e._v("RFC 7234"),r("OutboundLink")],1),e._v(" 中描述了浏览器和代理应该有那些默认行为：")]),e._v(" "),r("blockquote",[r("p",[e._v("Although caching is an entirely OPTIONAL feature of HTTP, it can be assumed that reusing a cached response is desirable and that such reuse is the default behavior when no requirement or local configuration prevents it. Therefore, HTTP cache requirements are focused on preventing a cache from either storing a non-reusable response or reusing a stored response inappropriately, rather than mandating that caches always store and reuse particular responses.")])]),e._v(" "),r("p",[e._v("简单来说，在本地没有配置阻止时，"),r("strong",[e._v("重用是默认行为")]),e._v("。")]),e._v(" "),r("p",[e._v("并且浏览器的决定缓存响应的新鲜度通常与最后修改时间有关：")]),e._v(" "),r("blockquote",[r("p",[e._v("Since origin servers do not always provide explicit expiration times, a cache MAY assign a heuristic expiration time when an explicit time is not specified, employing algorithms that use other header field values (such as the Last-Modified time)... If the response has a Last-Modified header field (Section 2.2 of ("),r("a",{attrs:{href:"https://tools.ietf.org/html/rfc7234#section-4.2.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("RFC7232"),r("OutboundLink")],1),e._v("), caches are encouraged to use a heuristic expiration value that is no more than some fraction of the interval since that time. A typical setting of this fraction might be 10%.")])]),e._v(" "),r("p",[e._v("意思就是浏览器会根据比如 "),r("code",[e._v("last_modified")]),e._v(" 字段，计算时间间隔，并乘以 10% 来计算。")]),e._v(" "),r("p",[e._v("再次 "),r("code",[e._v("cache-control")]),e._v(" 是没有默认值的，你没有设置就是没有。"),r("a",{attrs:{href:"https://stackoverflow.com/questions/14496694/whats-default-value-of-cache-control",target:"_blank",rel:"noopener noreferrer"}},[e._v("【详情】"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching#invalidating_and_updating_cached_responses",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP 缓存"),r("OutboundLink")],1)])]),e._v(" "),r("h3",{attrs:{id:"扩展"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[e._v("#")]),e._v(" 扩展")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://stackoverflow.com/questions/49547/how-do-we-control-web-page-caching-across-all-browsers",target:"_blank",rel:"noopener noreferrer"}},[e._v("关闭缓存"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://madhatted.com/2013/6/16/you-do-not-understand-browser-history",target:"_blank",rel:"noopener noreferrer"}},[e._v("浏览器历史与缓存"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=o.exports}}]);